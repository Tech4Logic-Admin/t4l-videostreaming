namespace T4L.VideoSearch.Api.Infrastructure.Adapters.Local;

/// <summary>
/// Mock malware scan provider for local development - always returns clean
/// </summary>
public class MockMalwareScanStatusProvider : IMalwareScanStatusProvider
{
    private readonly ILogger<MockMalwareScanStatusProvider> _logger;

    public MockMalwareScanStatusProvider(ILogger<MockMalwareScanStatusProvider> logger)
    {
        _logger = logger;
    }

    public Task<MalwareScanResult> GetScanStatusAsync(string containerName, string blobName, CancellationToken ct = default)
    {
        _logger.LogDebug("Mock Malware Scan: Checking {Container}/{Blob}", containerName, blobName);

        // Check for mock trigger to simulate malware
        if (blobName.Contains("infected_test"))
        {
            return Task.FromResult(new MalwareScanResult(
                State: MalwareScanState.Completed,
                IsMalicious: true,
                ThreatType: "Trojan.Test",
                ScannedAt: DateTime.UtcNow
            ));
        }

        // Simulate scan completion after a brief delay
        return Task.FromResult(new MalwareScanResult(
            State: MalwareScanState.Completed,
            IsMalicious: false,
            ThreatType: null,
            ScannedAt: DateTime.UtcNow
        ));
    }
}
